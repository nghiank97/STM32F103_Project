

#ifndef DCMotor_h
#define DCMotor_h

#include <stdio.h>
#include <math.h>
#include "main.h"
#include "Config.h"
#include "Encoder.h"
#include "L298.h"
#include "LSPB.h"

class DCMotor
{
public:
  DCMotor(L298* _l298, Encoder* encoder);

  void controller(void);
  void control_current(void);
  void getAdcVoltage(void);

  float shaftVelocity(void);
  float shaftAngle(void);

private:

  float i_a;
  float velocity;
  float position_sp, position;

  LSPB scuver{200, 0.01};

  PID PID_current_q{DEF_PID_CURR_Q_P, DEF_PID_CURR_Q_I, DEF_PID_CURR_Q_D, DEF_PID_CURR_LIMIT_Q};
  PID PID_current_d{DEF_PID_CURR_D_P, DEF_PID_CURR_D_I, DEF_PID_CURR_D_D, DEF_PID_CURR_LIMIT_D};
  PID PID_velocity{DEF_PID_VEL_P, DEF_PID_VEL_I, DEF_PID_VEL_D, DEF_PID_VEL_LIMIT};
  PID PID_angle{DEF_P_ANGLE_P, DEF_P_ANGLE_I, DEF_P_ANGLE_D, DEF_PID_ANG_LIMIT};

  L298* l298;
  Encoder* encoder;
};

#endif
