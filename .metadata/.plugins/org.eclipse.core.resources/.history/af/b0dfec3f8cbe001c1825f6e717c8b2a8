
#include "adc.h"

void AdcInit(){

/*
 * enable clock for gpioa.0
 * enable clock for adc
 * gpioa.0 configurature analog input
 * continuous mode
 * align right
 * 1 conversion
 *
 */
	RCC->APB2ENR |= RCC_APB2ENR_IOPAEN;
	RCC->APB2ENR |= RCC_APB2ENR_ADC1EN;

	GPIOA->CRL &=~ (0b1111<<12);	// 12 - ADC3
	GPIOA->CRL &=~ (0b1111<<16);	// 16 - ADC4

	ADC1->CR1 |= (0110<<16);
	ADC1->CR2 |= ADC_CR2_CONT;
	ADC1->CR2 |= (0<<11);
	ADC1->SQR3 |= (0000<<0);
	ADC1->CR1 |= (0000<<0);
}

uint16_t AdcGet(){
	ADC1->CR2 |= ADC_CR2_ADON;
	while(!(ADC1->SR)&(1<<ADC_SR_EOC));
	return (uint16_t)ADC1->DR & ADC_DR_DATA;
}
